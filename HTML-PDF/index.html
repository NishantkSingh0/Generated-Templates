<script>
  const fileInput = document.getElementById('fileInput');
  const uploadBtn = document.getElementById('uploadBtn');
  const statusDiv = document.getElementById('status');
  const pdfLink = document.getElementById('pdfLink');

  uploadBtn.addEventListener('click', async () => {
    const file = fileInput.files[0];
    if (!file || !file.name.endsWith('.html')) {
      statusDiv.innerHTML = '<div class="error">Please upload a valid .html file.</div>';
      return;
    }

    statusDiv.innerHTML = '<span class="loader"></span>Generating PDF...';
    uploadBtn.disabled = true;
    pdfLink.style.display = 'none';

    const reader = new FileReader();

    reader.onload = async function (event) {
      const htmlContent = event.target.result;

      try {
        const response = await fetch('https://html2pdfviabravers.onrender.com/generate-pdf', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ html: htmlContent }),
        });

        if (!response.ok) throw new Error('Failed to generate PDF.');

        const blob = await response.blob();
        const pdfUrl = URL.createObjectURL(blob);

        statusDiv.innerHTML = '';
        pdfLink.href = pdfUrl;
        pdfLink.download = 'resume.pdf';
        pdfLink.style.display = 'block';
      } catch (error) {
        statusDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
      } finally {
        uploadBtn.disabled = false;
      }
    };

    reader.onerror = () => {
      statusDiv.innerHTML = `<div class="error">Error reading file.</div>`;
      uploadBtn.disabled = false;
    };

    reader.readAsText(file);
  });
</script>
